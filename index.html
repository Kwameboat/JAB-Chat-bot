<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Digital Hub Chatbot</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <!-- Babel Standalone for in-browser compilation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <script>
      // Polyfill for process.env (Server injects the key here)
      window.process = window.process || { env: { API_KEY: '__GENAI_API_KEY__' } };
    </script>
    
    <style>
      body {
        font-family: 'Inter', sans-serif;
        background-color: #E5E5E5;
      }
      .scrollbar-hide::-webkit-scrollbar { display: none; }
      .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
      .bg-whatsapp-pattern {
        background-color: #e5ddd5;
        background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M15 15h10v10H15V15zm0 40h10v10H15V55zm0 40h10v10H15V95zm40-80h10v10H55V15zm0 40h10v10H55V55zm0 40h10v10H55V95zm40-80h10v10H95V15zm0 40h10v10H95V55zm0 40h10v10H95V95z' fill='%23d1d7db' fill-opacity='0.2'/%3E%3C/svg%3E");
      }
      .animate-fade-in {
        animation: fadeIn 0.3s ease-in-out;
      }
      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
      }
    </style>
    
    <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@18.2.0",
    "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
    "lucide-react": "https://esm.sh/lucide-react@0.263.1",
    "@google/genai": "https://esm.sh/@google/genai",
    "react-dom/": "https://esm.sh/react-dom@^19.2.3/",
    "react/": "https://esm.sh/react@^19.2.3/",
    "express": "https://esm.sh/express@^5.2.1",
    "path": "https://esm.sh/path@^0.12.7",
    "url": "https://esm.sh/url@^0.11.4",
    "fs": "https://esm.sh/fs@^0.0.1-security",
    "nodemailer": "https://esm.sh/nodemailer@^7.0.11"
  }
}
</script>
  </head>
  <body>
    <div id="root"></div>

    <!-- MAIN APPLICATION SCRIPT -->
    <script type="text/babel" data-type="module">
      import React, { useState, useEffect, useRef } from 'react';
      import ReactDOM from 'react-dom/client';
      import { Send, MoreVertical, Phone, Video, Paperclip, Smile, Link2, CheckCheck, Mail, X, Server, AlertTriangle, Key, Save, Clock, Info, CreditCard, ExternalLink, Zap, Gauge, Copy, ClipboardCheck, MessageCircle, ArrowRight, ExternalLink as LinkIcon } from 'lucide-react';
      import { GoogleGenAI } from '@google/genai';

      // --- TYPES & CONSTANTS ---
      const Sender = { USER: 'user', BOT: 'bot', ERROR: 'error' };
      
      const SERVICES_LIST = [
        "Website Design",
        "Company Management Systems",
        "WhatsApp Chatbots",
        "Social Media Marketing",
        "Graphic Design",
        "Branding",
        "General Digital Solutions"
      ];

      const SYSTEM_INSTRUCTION = `
You are a friendly, professional, and warm Digital Consultant for a "Digital Hub" company.
Your goal is to guide a potential client from a Facebook Ad click to a booked appointment via a conversation.

**Your Personality:**
- Warm, welcoming, and conversational.
- Not robotic. Use emojis occasionally (ðŸ‘‹, âœ¨, ðŸš€).
- Do not overwhelm the user with long paragraphs. Keep messages concise (under 3-4 sentences usually).
- Guide the user one step at a time.

**The Process (Follow this strictly):**
1. **Welcome & Name:** Warmly welcome them (assume they came from an ad). Ask for their name.
2. **Service Selection:** Once they give their name, ask what they are looking for. Present the services naturally: ${SERVICES_LIST.join(", ")}.
3. **Goal/Problem:** When they pick a service, ask a specific follow-up about their goal or the problem they want to solve.
4. **Budget:** Gently ask about their budget. Invite them to share a specific amount (e.g., "GHC 200") or a general range (Low, Medium, Premium) that works for them.
5. **Confirmation:** Summarize their Name, Service, Goal, and Budget. Ask them to confirm.
6. **Booking & WhatsApp Handoff:**
   - If they confirm, tell them you are generating the confirmation.
   - **CRITICAL:** You must generate a text block summarizing the appointment for WhatsApp.
   - Start this specific block with "APPOINTMENT_SUMMARY_START" and end it with "APPOINTMENT_SUMMARY_END".
   - The content inside should be formatted cleanly for a WhatsApp message:
     "ðŸ“… *New Appointment Request*
     
     ðŸ‘¤ *Name:* [Name]
     ðŸ›  *Service:* [Service]
     ðŸŽ¯ *Goal:* [Goal]
     ðŸ’° *Budget:* [Budget]
     
     *Status:* Pending Final Confirmation"
   - After the block, tell the user to click the button below to send this directly to our business WhatsApp line.
`;

      // --- HELPER: Get Effective API Key ---
      const getEffectiveApiKey = () => {
        // 1. Try Local Storage (Manual Override)
        const localKey = localStorage.getItem('gemini_api_key');
        if (localKey && localKey.trim().length > 0) return localKey;

        // 2. Try Server Env Injection
        const envKey = process.env.API_KEY;
        if (envKey && envKey !== '__GENAI_API_KEY__' && envKey.trim().length > 0) return envKey;

        return null;
      };

      // --- SERVICES ---
      let chatSession = null;
      let genAI = null;
      let currentModelName = '';

      const initializeChat = (forceLite = false) => {
        const apiKey = getEffectiveApiKey();
        
        if (!apiKey) {
          console.warn("API_KEY is missing.");
          return false;
        }

        const storedPref = localStorage.getItem('gemini_use_lite');
        let useLite = true; 
        if (storedPref === 'false') useLite = false;
        if (forceLite) useLite = true;

        const modelName = useLite ? 'gemini-flash-lite-latest' : 'gemini-2.5-flash';
        currentModelName = modelName;

        try {
            genAI = new GoogleGenAI({ apiKey: apiKey });
            chatSession = genAI.chats.create({
            model: modelName,
            config: {
                systemInstruction: SYSTEM_INSTRUCTION,
                temperature: 0.7,
            }
            });
            console.log(`Chat initialized with model: ${modelName}`);
            return true;
        } catch (err) {
            console.error("Failed to init chat:", err);
            return false;
        }
      };

      const delayPromise = (ms) => new Promise(resolve => setTimeout(resolve, ms));

      const sendMessageToGemini = async (message, onStatusUpdate) => {
        if (!chatSession) {
            const success = initializeChat();
            if (!success) throw new Error("API_KEY_MISSING");
        }
        if (!chatSession) throw new Error("CHAT_NOT_INITIALIZED");
        
        const MAX_RETRIES = 3;
        let attempt = 0;

        while (attempt <= MAX_RETRIES) {
            try {
                const result = await chatSession.sendMessage({ message });
                return result.text;
            } catch (error) {
                const errStr = error.toString();
                const errMsg = error.message || errStr;
                
                // Check for 429 (Quota Exceeded) or 503
                if (errStr.includes("429") || errStr.includes("RESOURCE_EXHAUSTED") || errMsg.includes("429") || errStr.includes("503")) {
                    
                    if (currentModelName !== 'gemini-flash-lite-latest') {
                        const fallbackMsg = "âš ï¸ High traffic. Switching to Lite model...";
                        if (onStatusUpdate) onStatusUpdate(fallbackMsg);
                        initializeChat(true);
                        localStorage.setItem('gemini_use_lite', 'true');
                        attempt = 0; 
                        await delayPromise(1000);
                        continue; 
                    }

                    attempt++;
                    if (attempt > MAX_RETRIES) throw error;

                    const match = errMsg.match(/retry in (\d+(\.\d+)?)s/);
                    const waitSeconds = match ? Math.ceil(parseFloat(match[1])) : 5;
                    const safeWait = waitSeconds + 1;
                    if (onStatusUpdate) onStatusUpdate(`â³ High traffic. Waiting ${safeWait}s...`);
                    await delayPromise(safeWait * 1000);
                    if (onStatusUpdate) onStatusUpdate("Retrying...");
                    continue;
                }
                throw error;
            }
        }
        throw new Error("Failed after retries");
      };

      // --- COMPONENTS ---

      // ChatMessage Component
      const ChatMessage = ({ message }) => {
        const isUser = message.sender === Sender.USER;
        const isError = message.sender === Sender.ERROR;
        const isSummary = message.isEmailSummary; // Reuse logic for Summary
        const [copied, setCopied] = useState(false);
        const businessNumber = localStorage.getItem('gemini_business_number') || '233541234567'; // Default placeholder

        const formatTime = (date) => date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });

        const handleCopy = () => {
            navigator.clipboard.writeText(message.text).then(() => {
                setCopied(true);
                setTimeout(() => setCopied(false), 2000);
            });
        };

        if (isError) {
             return (
                <div className="flex justify-center my-2 w-full px-4 animate-fade-in">
                    <div className="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg text-sm flex items-start gap-2 shadow-sm max-w-sm break-words">
                        <AlertTriangle size={18} className="mt-0.5 shrink-0" />
                        <div>{message.text}</div>
                    </div>
                </div>
             );
        }

        if (isSummary) {
            const whatsappUrl = `https://wa.me/${businessNumber}?text=${encodeURIComponent(message.text)}`;

            return (
            <div className="flex justify-center my-4 animate-fade-in px-4 w-full">
                <div className="bg-white rounded-lg shadow-md border border-green-100 w-full max-w-sm overflow-hidden">
                <div className="bg-[#25D366] text-white p-3 flex items-center gap-2">
                    <MessageCircle size={20} />
                    <span className="font-bold text-sm">Appointment Ready</span>
                </div>
                
                <div className="p-4 bg-green-50/50">
                    <div className="text-xs text-gray-500 mb-2 font-medium uppercase tracking-wider">Confirm Details</div>
                    <div className="text-sm text-gray-800 whitespace-pre-wrap font-sans leading-relaxed border-l-4 border-[#25D366] pl-3 py-1">
                        {message.text}
                    </div>
                </div>

                <div className="bg-white p-3 border-t border-gray-100 flex flex-col gap-2">
                    <a 
                        href={whatsappUrl}
                        target="_blank"
                        rel="noreferrer"
                        className="flex items-center justify-center gap-2 w-full bg-[#075E54] hover:bg-[#064c44] text-white py-3 rounded-lg font-semibold text-sm transition-transform active:scale-95 shadow-sm"
                    >
                        <span>Send to Business WhatsApp</span>
                        <ArrowRight size={16} />
                    </a>
                    
                    <button 
                        onClick={handleCopy}
                        className="text-xs text-gray-400 hover:text-gray-600 font-medium py-1 flex items-center justify-center gap-1"
                    >
                        {copied ? "Copied to clipboard" : "Copy text only"}
                    </button>
                </div>
                </div>
            </div>
            );
        }

        return (
            <div className={`flex w-full mb-3 ${isUser ? 'justify-end' : 'justify-start'}`}>
            <div className={`relative max-w-[85%] sm:max-w-[70%] px-4 py-2 rounded-lg shadow-sm text-sm leading-relaxed ${isUser ? 'bg-[#dcf8c6] text-gray-900 rounded-tr-none' : 'bg-white text-gray-900 rounded-tl-none'}`}>
                <div className="whitespace-pre-wrap">{message.text}</div>
                <div className="flex justify-end items-center mt-1 space-x-1">
                <span className="text-[10px] text-gray-500">{formatTime(message.timestamp)}</span>
                {isUser && <CheckCheck size={14} className="text-blue-500" />}
                </div>
            </div>
            </div>
        );
      };

      // ConnectModal Component
      const ConnectModal = ({ isOpen, onClose }) => {
        const savedNumber = localStorage.getItem('gemini_business_number');
        const [manualKey, setManualKey] = useState(localStorage.getItem('gemini_api_key') || '');
        const [businessNumber, setBusinessNumber] = useState(savedNumber || '');
        const storedLitePref = localStorage.getItem('gemini_use_lite');
        const initialLiteState = storedLitePref === 'false' ? false : true; 
        const [useLite, setUseLite] = useState(initialLiteState);
        const [showSuccess, setShowSuccess] = useState(false);

        const handleSave = () => {
            if (manualKey.trim()) {
                localStorage.setItem('gemini_api_key', manualKey.trim());
            } else {
                localStorage.removeItem('gemini_api_key');
            }
            
            if (businessNumber.trim()) {
                localStorage.setItem('gemini_business_number', businessNumber.trim().replace(/\+/g, ''));
            } else {
                localStorage.removeItem('gemini_business_number');
            }

            localStorage.setItem('gemini_use_lite', String(useLite));

            setShowSuccess(true);
            setTimeout(() => {
                setShowSuccess(false);
                window.location.reload(); 
            }, 1000);
        };

        if (!isOpen) return null;
        
        return (
            <div className="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4 animate-fade-in">
            <div className="bg-white rounded-xl shadow-2xl w-full max-w-2xl max-h-[90vh] flex flex-col overflow-hidden">
                <div className="bg-[#075E54] p-4 flex justify-between items-center text-white shrink-0">
                <div className="flex items-center gap-2">
                    <Server size={20} />
                    <h2 className="text-lg font-semibold">Connect & Setup</h2>
                </div>
                <button onClick={onClose} className="hover:bg-white/20 p-1 rounded-full transition"><X size={20} /></button>
                </div>
                <div className="p-6 overflow-y-auto">
                
                <div className="space-y-6">

                     <div className="bg-orange-50 p-4 rounded-md border border-orange-200">
                        <strong className="text-orange-800 text-sm flex items-center gap-2 mb-2">
                            <Zap size={16} /> Gemini API Config
                        </strong>
                        <p className="text-xs text-orange-800 mb-2">
                            Get a free API Key from <a href="https://aistudio.google.com/app/apikey" target="_blank" className="underline font-bold">Google AI Studio</a>.
                        </p>
                    </div>
                
                    {/* Step 1: API Key */}
                    <div className="bg-blue-50 p-4 rounded-md border border-blue-200">
                        <strong className="text-blue-800 text-sm flex items-center gap-2 mb-2">
                            <Key size={16} /> 1. AI API Key (Required)
                        </strong>
                        <div className="flex gap-2 mb-3">
                            <input 
                                type="password" 
                                value={manualKey}
                                onChange={(e) => setManualKey(e.target.value)}
                                placeholder="Paste your AIza... key here"
                                className="flex-1 px-3 py-2 text-sm border border-blue-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                            />
                        </div>
                    </div>

                    {/* Step 2: Business WhatsApp Number */}
                    <div className="bg-green-50 p-4 rounded-md border border-green-200">
                        <div className="flex justify-between items-start mb-2">
                            <strong className="text-green-800 text-sm flex items-center gap-2">
                                <MessageCircle size={16} /> 2. Business WhatsApp Number
                            </strong>
                            {savedNumber && (
                                <span className="text-[10px] bg-green-200 text-green-800 px-2 py-0.5 rounded-full font-mono border border-green-300">
                                    Active: {savedNumber}
                                </span>
                            )}
                        </div>
                        
                        <p className="text-xs text-green-700 mb-2">
                            Where should confirmations be sent? (Format: 233555XXXXXX)
                        </p>
                        <div className="flex gap-2 mb-1">
                            <input 
                                type="text" 
                                value={businessNumber}
                                onChange={(e) => setBusinessNumber(e.target.value)}
                                placeholder="e.g. 233541234567"
                                className="flex-1 px-3 py-2 text-sm border border-green-300 rounded focus:outline-none focus:ring-2 focus:ring-green-500"
                            />
                        </div>
                        {/* Test Link */}
                        {businessNumber && (
                            <a 
                                href={`https://wa.me/${businessNumber.replace(/\+/g, '')}`} 
                                target="_blank" 
                                rel="noreferrer" 
                                className="text-xs text-green-600 underline hover:text-green-800 flex items-center gap-1 inline-flex mt-1"
                            >
                                <LinkIcon size={10} /> Test this number (opens WhatsApp)
                            </a>
                        )}
                    </div>

                    <div className="flex flex-col gap-4">
                        <div className="flex items-start gap-3 bg-white p-3 rounded border border-gray-200">
                            <input 
                                type="checkbox" 
                                id="liteModel" 
                                checked={useLite} 
                                onChange={(e) => setUseLite(e.target.checked)}
                                className="mt-1 w-4 h-4 text-blue-600 rounded focus:ring-blue-500 cursor-pointer"
                            />
                            <label htmlFor="liteModel" className="cursor-pointer select-none">
                                <div className="flex items-center gap-1.5 text-sm font-semibold text-gray-800">
                                    <Gauge size={16} className="text-purple-600"/> 
                                    Use 'Lite' Model (Recommended)
                                </div>
                            </label>
                        </div>

                        <button 
                            onClick={handleSave}
                            className="w-full bg-[#075E54] text-white px-4 py-3 rounded-lg text-sm font-semibold hover:bg-[#064c44] transition flex items-center justify-center gap-2"
                        >
                            {showSuccess ? <CheckCheck size={18}/> : <Save size={18}/>}
                            {showSuccess ? "Settings Saved!" : "Save Settings"}
                        </button>
                    </div>

                </div>
                </div>
            </div>
            </div>
        );
      };

      // Main App Component
      function App() {
        const [messages, setMessages] = useState([]);
        const [inputText, setInputText] = useState('');
        const [isTyping, setIsTyping] = useState(false);
        const [typingStatus, setTypingStatus] = useState('');
        const [hasStarted, setHasStarted] = useState(false);
        const [isConnectModalOpen, setIsConnectModalOpen] = useState(false);
        const messagesEndRef = useRef(null);
        
        const isApiKeyMissing = !process.env.API_KEY || process.env.API_KEY === '__GENAI_API_KEY__'; // Basic check only for UI hint

        const scrollToBottom = () => messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
        
        useEffect(() => { scrollToBottom(); }, [messages, isTyping, typingStatus]);
        
        useEffect(() => {
            initializeChat();
            
            if (isApiKeyMissing) {
                setIsConnectModalOpen(true);
            }

            setTimeout(() => handleInitialWelcome(), 1000);
        }, []);

        const handleInitialWelcome = async () => {
            setIsTyping(true);
            try {
                const welcomeText = await sendMessageToGemini("Hello, I just clicked your Facebook ad.");
                addBotMessage(welcomeText);
            } catch (e) {
                if (e.message === "API_KEY_MISSING") {
                    setMessages(prev => [...prev, { 
                        id: Date.now(), 
                        text: "Welcome! To get started, please click the 'Setup' icon above and paste your API Key.", 
                        sender: Sender.ERROR, 
                        timestamp: new Date() 
                    }]);
                } else {
                    console.error("Welcome message failed:", e);
                    addBotMessage("Hi there! Welcome to our Digital Hub. I'm here to help you get started. What is your name?");
                }
            } finally {
                setIsTyping(false);
                setHasStarted(true);
            }
        };

        const addBotMessage = (rawText) => {
            // NEW TAGS for WhatsApp flow
            const startTag = "APPOINTMENT_SUMMARY_START";
            const endTag = "APPOINTMENT_SUMMARY_END";
            
            let processedMessages = [];
            
            if (rawText && rawText.includes(startTag) && rawText.includes(endTag)) {
                const parts = rawText.split(startTag);
                const preText = parts[0].trim();
                const rest = parts[1].split(endTag);
                const summaryContent = rest[0].trim();
                const postText = rest[1]?.trim();

                if (preText) processedMessages.push({ id: Date.now() + '-pre', text: preText, sender: Sender.BOT, timestamp: new Date() });
                
                // Add Summary Card
                processedMessages.push({ 
                    id: Date.now() + '-summary', 
                    text: summaryContent, 
                    sender: Sender.BOT, 
                    timestamp: new Date(), 
                    isEmailSummary: true 
                });
                
                if (postText) processedMessages.push({ id: Date.now() + '-post', text: postText, sender: Sender.BOT, timestamp: new Date() });
            } else {
                processedMessages.push({ id: Date.now(), text: rawText || "...", sender: Sender.BOT, timestamp: new Date() });
            }

            processedMessages.forEach((msg, index) => {
                setTimeout(() => setMessages(prev => [...prev, msg]), index * 500);
            });
        };

        const handleSendMessage = async () => {
            if (!inputText.trim()) return;
            const userMsg = { id: Date.now(), text: inputText, sender: Sender.USER, timestamp: new Date() };
            setMessages(prev => [...prev, userMsg]);
            setInputText('');
            setIsTyping(true);
            setTypingStatus('');
            
            try {
                const response = await sendMessageToGemini(inputText, (status) => {
                    setTypingStatus(status);
                });
                setIsTyping(false);
                setTypingStatus('');
                addBotMessage(response);
            } catch (error) {
                setIsTyping(false);
                setTypingStatus('');
                let errorMessage = "Connection error. Please try again.";
                
                const errorStr = error.toString();
                if (errorStr.includes("429") || errorStr.includes("RESOURCE_EXHAUSTED")) {
                     errorMessage = "âš ï¸ High Traffic: Maximum retries exceeded. Please try again in 1 minute.";
                } else if (error.message === 'API_KEY_MISSING') {
                    errorMessage = "Setup Required: Click the Setup icon above to set your API Key.";
                    setIsConnectModalOpen(true);
                } else {
                     try {
                        const match = errorStr.match(/{.*}/);
                        if (match) {
                            const errObj = JSON.parse(match[0]);
                            if (errObj.error && errObj.error.message) {
                                errorMessage = `Error: ${errObj.error.message}`;
                            }
                        }
                     } catch(e) {}
                }
                
                setMessages(prev => [...prev, { 
                    id: Date.now(), 
                    text: errorMessage, 
                    sender: Sender.ERROR, 
                    timestamp: new Date() 
                }]);
            }
        };

        return (
            <div className="flex justify-center items-center min-h-screen bg-gray-100">
                <ConnectModal isOpen={isConnectModalOpen} onClose={() => setIsConnectModalOpen(false)} />
                <div className="w-full h-screen sm:h-[85vh] sm:w-[400px] bg-[#e5ddd5] sm:rounded-[30px] shadow-2xl overflow-hidden flex flex-col relative border border-gray-300">
                    <div className="bg-[#075E54] p-3 text-white flex items-center justify-between z-10 shadow-sm shrink-0">
                        <div className="flex items-center gap-3">
                            <div className="w-10 h-10 rounded-full bg-white flex items-center justify-center overflow-hidden">
                                <img src="https://picsum.photos/200/200" alt="Consultant" className="w-full h-full object-cover" />
                            </div>
                            <div className="flex flex-col">
                                <span className="font-semibold text-base leading-tight">Digital Hub Consultant</span>
                                <span className="text-xs text-gray-200">Online</span>
                            </div>
                        </div>
                        <div className="flex items-center gap-4 text-white/90">
                            <button 
                                onClick={() => setIsConnectModalOpen(true)} 
                                className={`hover:bg-white/10 p-1.5 rounded-full transition-colors flex items-center gap-1 ${isApiKeyMissing ? 'bg-white/20 animate-pulse text-yellow-300' : ''}`} 
                                title="Settings"
                            >
                                <Link2 size={20} />
                                {isApiKeyMissing && <span className="text-[10px] font-bold">SETUP</span>}
                            </button>
                            <MoreVertical size={20} className="cursor-pointer hover:text-white" />
                        </div>
                    </div>

                    <div className="flex-1 overflow-y-auto p-4 bg-whatsapp-pattern relative">
                        {messages.map((msg) => <ChatMessage key={msg.id} message={msg} />)}
                        {isTyping && (
                             <div className="flex w-full mb-3 justify-start animate-fade-in">
                               <div className="flex flex-col gap-1">
                                 <div className="bg-white px-4 py-3 rounded-lg rounded-tl-none shadow-sm flex gap-1 items-center w-fit">
                                    <div className="w-2 h-2 bg-gray-400 rounded-full animate-bounce"></div>
                                    <div className="w-2 h-2 bg-gray-400 rounded-full animate-bounce delay-100"></div>
                                    <div className="w-2 h-2 bg-gray-400 rounded-full animate-bounce delay-200"></div>
                                 </div>
                                 {typingStatus && (
                                     <span className="text-[10px] text-gray-500 font-medium ml-1 bg-white/50 px-2 py-1 rounded w-fit">{typingStatus}</span>
                                 )}
                               </div>
                            </div>
                        )}
                        <div ref={messagesEndRef} />
                    </div>

                    <div className="bg-[#F0F0F0] p-2 flex items-center gap-2 shrink-0">
                        <div className="flex-1 bg-white rounded-full px-4 py-2 shadow-sm border border-gray-200">
                            <input
                                type="text"
                                value={inputText}
                                onChange={(e) => setInputText(e.target.value)}
                                onKeyDown={(e) => e.key === 'Enter' && handleSendMessage()}
                                placeholder="Type a message"
                                className="w-full outline-none text-gray-700 placeholder-gray-400 bg-transparent text-sm"
                                disabled={!hasStarted}
                            />
                        </div>
                        <button 
                            onClick={handleSendMessage}
                            className={`w-10 h-10 rounded-full flex items-center justify-center transition-colors shadow-sm ${inputText.trim() ? 'bg-[#075E54] text-white hover:bg-[#064c44]' : 'bg-gray-300 text-gray-500'}`}
                            disabled={!inputText.trim()}
                        >
                            <Send size={18} className={inputText.trim() ? 'ml-1' : ''} />
                        </button>
                    </div>
                    <div className="h-1 bg-[#F0F0F0] w-full"></div>
                </div>
            </div>
        );
      }

      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<App />);
    </script>
  </body>
</html>